---
marp: true
title: Java Spring Boot & SQL
description: Short introduction for novice developers to use SQL in Java

theme: gaia
class:
  - invert

paginate: true
_paginate: false
footer: 'Slides by [Ansgar Hugo](http://www.ansgar-hugo.de)'


---
## SQL - Structured Query Language
- ANSI Standard since SQL-86
- many dialects and proprietary per vendor
- many versions: SQL-86, SQL-89, SQL-92,... SQL:2016
- Don't panic, there is a common subset which covers 99%

---
## SQL - Structure
- DDL: Data definition language (CREATE, DROP, ALTER, TRUNCATE)
- DQL: Data query language (SELECT)
- DML: Data manipulation language (INSERT, UPDATE)
- DCL: Data control language (GRANT, REVOKE)

---
## DB Tool - Intellij Idea - Add datasource
![h:400px](img/idea_01.png "Add datasource")

---
## DB Tool - Intellij Idea - Configure connection

![h:400px](img/idea_02.png "Configure jdbc connection")

---
## DB Tool - Intellij Idea - Test connection
![h:400px](img/idea_03.png "Test connection")

---
## DB Tool - Intellij Idea - Select schema
![h:400px](img/idea_04.png "Select public schema")

---
## DB Tool - Intellij Idea - Timezone
![h:400px](img/idea_06_timezone.pngg "timezone")

---
## DB Tool - Intellij Idea - Open console
![h:400px](img/idea_05.png "console")

---
## Create table
```sql
CREATE TABLE player
(
  id       BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  name     TEXT NOT NULL,
  birthday DATE NOT NULL
);
```

---
## Create table with reference
```sql
CREATE TABLE booking
(
  id         BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  court      INT       NOT NULL,
  player_id  BIGSERIAL NOT NULL REFERENCES player (id),
  start_time TIMESTAMP WITH TIME ZONE,
  end_time   TIMESTAMP WITH TIME ZONE
);
```

---
## PostgreSQL data types
[Postgres Data Types](https://www.postgresql.org/docs/current/datatype.html)

---
## Insert new data

```sql
INSERT INTO player (id, name, birthday)
VALUES (DEFAULT, 'Sandra', '2002-04-01');

INSERT INTO player (name, birthday)
VALUES ('Peter', '2005-05-01');
```

---
## Bulk insert
```sql
INSERT INTO player (name, birthday)
VALUES ('Leon', '1990-12-01'),
       ('Paul', '1993-06-01'),
       ('Ben', '2004-09-01'),
       ('Finn', '1988-08-01'),
       ('Felix', '2001-06-01'),
       ('Lina', '2003-03-01'),
       ('Lea', '1996-11-01'),
       ('Clara', '1989-12-01'),
       ('Hanna', '2000-01-01');
```

---
## Query data
```sql
-- select all players born after year 2000
SELECT *
FROM player
WHERE birthday >= '2000-01-01';
```
```sql
-- Select all adults
SELECT *
FROM player
WHERE birthday < NOW() - INTERVAL '18 years';
```
---
## More queries
```sql
SELECT *
FROM player
WHERE birthday < NOW() - INTERVAL '18 years'
AND name ilike 'l%';
```
---
## Update existing data
```sql
UPDATE player
SET birthday = '2005-02-15'
WHERE name = 'Peter';
```
Exercise:
- Add other Peter (yes, same name) with different birthday
- Update Peters birthday to 1st of November 1999
- What's the result?

---
## Delete existing data
```sql
-- good ides: first check what you delete
SELECT *
FROM player
where name = 'Peter';

-- delete players by name
DELETE
FROM player
WHERE name = 'Peter';
```
---
## Constraints - Some examples
```sql
-- Alternative way of adding constraints later:
ALTER TABLE booking ADD FOREIGN KEY ("player_id") REFERENCES player ("id");

-- prevent duplicates
CREATE UNIQUE INDEX player_name_uidx ON player(name);

-- index used for search
CREATE INDEX player_birthday_idx ON player(birthday);
```
